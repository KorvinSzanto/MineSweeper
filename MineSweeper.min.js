(function(a){mineSweeper=function(b,c,d){c=c<9?9:c,b=b<9?9:b,d=d>b*c-1?b*c-1:d;var e="<tr><td class='score' colspan="+b+"><span class='info'><span class='flags'>0</span><span class='smiley'>:|</span><span class='mines'>"+d+"</span></span></td></tr><tr><td colspan="+b+" class=time>00:00:00</td></tr>";for(var f=0;++f<=c;){e+="<tr>";for(var g=0;++g<=b;)e+="<td id='x"+g+"y"+f+"' class='block hide' title='n'><div>&nbsp;</div></td>";e+="</tr>"}a(".minefield").css({width:(b+2)*20,height:(c+2)*20}).append(e).attr("cellpadding",0).attr("cellspacing",0),a(".block",".minefield").bind("contextmenu",function(a){a.preventDefault()}),a(".block",".minefield").mouseup(function(e){a(".smiley",".minefield").text(":)");switch(e.which){case 1:var f=getXY(a(this));a(".mine",".block").length==0&&(time=Math.round((new Date).getTime()/1e3),timer=window.setInterval(function(){var b=Math.round((new Date).getTime()/1e3);seconds=b-time,hours=Math.floor(seconds/3600),seconds%=3600,minutes=Math.floor(seconds/60),seconds%=60,a(".time",".minefield").text((hours<10?"0"+hours:hours)+":"+(minutes<10?"0"+minutes:minutes)+":"+(seconds<10?"0"+seconds:seconds))},1e3),placeMines(b,c,d,f[0],f[1]),a.each(a(".block",".minefield"),function(){num=blockNumber(a(this)),a(this).attr("title",num).children("div").text(num==0?"":num)})),a(this).hasClass("hide")&&reveal(a(this));break;case 3:return e.preventDefault(),a(this).hasClass("flagged")?a(this).removeClass("flagged"):a(this).hasClass("hide")&&a(this).addClass("flagged"),getScore(),!1}getScore()}).mousedown(function(b){a(".smiley",".minefield").text(":O")}),a(".block",".minefield").dblclick(function(){blockNumber(a(this))<=nearFlags(a(this))&&showBlocks(a(this)),getScore()}),a("div",".block").dblclick(function(){blockNumber(a(this).parent())<=nearFlags(a(this).parent())&&showBlocks(a(this).parent()),getScore()}),nearFlags=function(a){var b=getXY(a)[0],c=getXY(a)[1];if(isFlag(b,c)===!1){--c,--b;var d=0;for(mody=0;mody<3;mody++)for(modx=0;modx<3;modx++){var e=b+modx,f=c+mody;isFlag(e,f)&&++d}return d}return"0"},getXY=function(a){if(typeof a=="object"){var b=a.attr("id").split(" ")[0].split("y"),c=[];return c[0]=b[0].split("x")[1],c[1]=b[1],c}},isMine=function(a,b){return bl(a,b).hasClass("mine")},isFlag=function(a,b){return bl(a,b).hasClass("flagged")},blockNumber=function(a){if(a.attr("title")!="n")return a.attr("title");var b=getXY(a)[0],c=getXY(a)[1];if(isMine(b,c)===!1){--c,--b;var d=0;for(mody=0;mody<3;mody++)for(modx=0;modx<3;modx++){var e=b+modx,f=c+mody;isMine(e,f)&&++d}return d}return"x"},bl=function(b,c){return a("#x"+b+"y"+c)},placeMines=function(b,c,d,e,f){while(a(".mine").length<d){var g=Math.round(Math.random()*b),h=Math.round(Math.random()*c);bl(g,h).hasClass("mine")==0&&g+","+h!=e+","+f&&bl(g,h).addClass("mine")}},reveal=function(a){if(!a.hasClass("hide"))return;a.removeClass("hide").removeClass("flagged");var b=getXY(a)[0],c=getXY(a)[1];isMine(b,c)&&loseGame();if(blockNumber(a)=="0"){a.children("div").text(""),--c,--b;var d=0,e,f;for(e=0;e<3;e++)for(f=0;f<3;f++){var g=b+f,h=c+e;reveal(bl(g,h))}}},showBlocks=function(a){var b=getXY(a)[0],c=getXY(a)[1];--c,--b;var d=0,e,f;for(e=0;e<3;e++)for(f=0;f<3;f++){var g=b+f,h=c+e;isFlag(g,h)||reveal(bl(g,h))}},getScore=function(){var b=a(".flagged").length,c=a(".mine").length,d=a(".hide").length,e=a(".flagged.mine").length;e==c&&b==c&&(a(".flags",".minefield").text(c),winGame()),d==c&&(a(".flags",".minefield").text(c),a(".hide").addClass("flagged"),winGame()),a(".flags",".minefield").text(b),a(".mines",".minefield").text(c)},winGame=function(){window.clearInterval(timer),a(".smiley",".minefield").text("8)"),a(".mine",".block").addClass("flagged"),a(".block",".minefield").removeClass("hide"),a(".flags",".minefield").text(a(".mines",".minefield").text())},loseGame=function(){window.clearInterval(timer),a(".block",".minefield").removeClass("hide"),a(".smiley",".minefield").text(":'(")}}})(jQuery)